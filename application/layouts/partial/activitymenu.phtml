<div id="block-activity-menu" class="block">
    <div class="block-inner">
        <h2 class="title">Activity Menu</h2>
        <div class="content">
            <ul>
            
            <?php
            $identity = $this->userInfo();
            $url = Zend_Controller_Front::getInstance()->getRequest()->getParams();
            $paramValue = $url['class'];
            $model = new Model_Wep();
            
            $defaultField = $model->getDefaults('default_field_groups', 'account_id', $identity->account_id);
            
            $class = '';
            $href2 = $this->baseUrl(). "/wep/edit-activity-elements/?activity_id=". $url['activity_id'] ."&class=ReportingOrg";
            $attributes = (getRowSet('ReportingOrg', $url['activity_id']))?'class = "active"':'';
            if($paramValue == 'ReportingOrg'){
                $class = "class = highlight";
            }
            print "<li $class><div class='help reporting_org'></div><a $attributes href=$href2>Reporting Organisation</a></li>";
            
            $attributes = (getRowSet('Identifier', $url['activity_id']))?'class = "active"':'';
            $href1 = $this->baseUrl() . "/wep/edit-activity-elements/?activity_id=". $url['activity_id'] ."&class=Identifier";
            $class = '';
            if($paramValue == 'Identifier'){
                $class = "class = highlight";
            }
            print "<li $class ><div class='help identifier'></div><a $attributes href=$href1>Iati Identifier</a></li>";
            
            $allowed_elements = $defaultField->getProperties();
            $elements = array('other_activity_identifier','title','description','activity_status','activity_date','contact_info','participating_org','recipient_country','recipient_region','location','sector','policy_marker','collaboration_type','default_flow_type','default_finance_type','default_aid_type','default_tied_status','budget','planned_disbursement','transaction','document_link','activity_website','related_activity','conditions','result');
            foreach($elements as $element)
            {
                if($allowed_elements[$element])
                {
                    $attributes = '';
                    if(getRowSet($element, $url['activity_id'])){
                        $attributes = 'class = "active"';
                    }
                    
                    $key = ucwords(str_replace("_"," ",$element));
                    $href = $this->baseUrl()."/wep/edit-activity-elements/?activity_id=". $url['activity_id'] ."&class=".str_replace(" ", "", $key);
                    $class = '';
                    if(str_replace(" ", "", $key) == $paramValue){
                        $class = "class = highlight";
                    }
                    print "<li $class><div class='help ".$element."'></div><a $attributes href='". $href ."'>" .$key ."</a></li>";
                }
            }
            ?>
            
            </ul>
        </div>
</div>
</div>

<?php 
function getRowSet($name, $id)
{
    $tableName = "";
    $tableMapper = new Iati_WEP_TableClassMapper();
    $string = "Iati_Activity_Element_". $tableMapper->convertUnderscoreToCamelCase($name);
    $obj = new $string ();
    $name = $obj->getType();
    unset($obj);
    $tableName = $tableMapper->getTableName($name);
    $wepModel = new Model_Wep();
    $rowSet = $wepModel->getRowsByFields($tableName, 'activity_id', $id);
    if($rowSet)
        $rowSet = true;
    return $rowSet;
}
?>