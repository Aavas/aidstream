<div id="block-activity-menu" class="block">
    <div class="block-inner">
        <h2 class="title">Activity Menu</h2>
        <div class="content">
            <ul>
            
            <?php
            $identity = $this->userInfo();
            $url = Zend_Controller_Front::getInstance()->getRequest()->getParams();
            $paramValue = $url['class'];
            $model = new Model_Wep();
            
            $defaultField = $model->getDefaults('default_field_groups', 'account_id', $identity->account_id);
            
            $attributes = (getRowSet('Identifier', $url['activity_id']))?'class = "active"':'';
            $href1 = $this->baseUrl() . "/wep/edit-activity-elements/?activity_id=". $url['activity_id'] ."&class=Identifier";
            $class = '';
            if($paramValue == 'Identifier'){
                $class = "class = highlight";
            }
            print "<li $class ><a $attributes href=$href1>Iati Identifier</a></li>";
            $class = '';
            $href2 = $this->baseUrl(). "/wep/edit-activity-elements/?activity_id=". $url['activity_id'] ."&class=ReportingOrg";
            $attributes = (getRowSet('ReportingOrg', $url['activity_id']))?'class = "active"':'';
            if($paramValue == 'ReportingOrg'){
                $class = "class = highlight";
            }
            print "<li $class><a $attributes href=$href2>Reporting Organisation</a></li>";
            foreach($defaultField->getProperties() as $key => $eachData){
                if($eachData == 1){
                   $attributes = '';
                    if(getRowSet($key, $url['activity_id'])){
                        $attributes = 'class = "active"';
                    }
                    
                    $key = ucwords(str_replace("_"," ",$key));
                    $href = $this->baseUrl()."/wep/edit-activity-elements/?activity_id=". $url['activity_id'] ."&class=".str_replace(" ", "", $key);
                    $class = '';
                    if(str_replace(" ", "", $key) == $paramValue){
                        $class = "class = highlight";
                    }
                    print "<li $class><a $attributes href='". $href ."'>" .$key ."</a></li>";
                    
                }
            }//add-activity-elements?activity_id='.$activity_id .'&class='.$class
            ?>
            
            </ul>
        </div>
</div>
</div>

<?php 
function getRowSet($name, $id)
{
    $tableName = "";
    $tableMapper = new Iati_WEP_TableClassMapper();
    $string = "Iati_Activity_Element_". $tableMapper->convertUnderscoreToCamelCase($name);
    $obj = new $string ();
    $name = $obj->getType();
    unset($obj);
    $tableName = $tableMapper->getTableName($name);
    $wepModel = new Model_Wep();
    $rowSet = $wepModel->getRowsByFields($tableName, 'activity_id', $id);
//    print_r($rowSet);exit;
    if($rowSet)
        $rowSet = true;
    return $rowSet;
}
?>